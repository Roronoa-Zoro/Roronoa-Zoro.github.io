---
layout: post
title:  "mysql order by"
date:   2017-03-23 +0800
categories: SQL
tags: mysql
author: Jimmy Lee
---

* content
{:toc}

### 需求
一个表字段叫status,值是1,2,3,4,5,6,7,8,9

project manager想进行分类,然后某一类的排序规则是按照status 1,5,3,4 排序,相同状态的按时间排序

### 实现sql
```sql
select demo_id,status,create_time from demo_table 
where userId='123456' and status in (1,5,3,4) 
order by field(status,1,5,3,4), demo_id desc
limit 0,30;
```
这种查询用到了一个函数order by field,看执行计划用到了file sort,查询了一下并不是用到了磁盘排序,而是一个排序操作

在开发环境把数据造到1000w,查询依然可以走0.0几秒完成,暂时使用这种方式,虽说大量查询可能会有性能问题,先标记一下,慢慢观察,出现性能问题使用下面的方式改写


```sql
select * from (
select * from (select demo_id,status,create_time from demo_table where userId='123456789' and status=1 order by demo_id desc) t1 
union all
select * from (select demo_id,status,create_time from demo_table where userId='123456789' and status=5 order by demo_id desc) t2 
union all
select * from (select demo_id,status,create_time from demo_table where userId='123456789' and status=3 order by demo_id desc) t3 
union all
select * from (select demo_id,status,create_time from demo_table where userId='123456789' and status=4 order by demo_id desc) t4 
) t5 
limit 0,30;
```
因为要union all,所以用了临时表,同样的1000w数据,查询cost和上面基本一样

比上面麻烦的就是有多个分类组合的时候需要写多个sql


